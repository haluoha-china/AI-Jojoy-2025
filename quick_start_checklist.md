# ğŸš€ å¿«é€Ÿå¯åŠ¨æ£€æŸ¥æ¸…å•

## âœ… éƒ¨ç½²å‰æ£€æŸ¥

- [ ] ç¡®è®¤æœåŠ¡å™¨æœ‰ RTX 4090 24GB GPU
- [ ] ç¡®è®¤ Ubuntu 22.04 ç³»ç»Ÿ
- [ ] ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] ç¡®è®¤æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆå»ºè®® 100GB+ï¼‰

## ğŸš€ ä¸€é”®éƒ¨ç½²

```bash
# 1. ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x dify_enterprise_kb_setup.sh

# 2. è¿è¡Œéƒ¨ç½²è„šæœ¬
./dify_enterprise_kb_setup.sh
```

## ğŸ” éƒ¨ç½²åéªŒè¯

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker ps

# åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æœåŠ¡ï¼š
# - milvus (å‘é‡æ•°æ®åº“)
# - bge_embedding (ä¸­æ–‡Embedding)
# - minicpm_video (è§†é¢‘ç†è§£)
# - qwen_vl (å›¾åƒç†è§£)
# - dify-web (Difyå¹³å°)
```

### 2. æ£€æŸ¥ç«¯å£å¼€æ”¾
```bash
# æ£€æŸ¥å…³é”®ç«¯å£
netstat -tlnp | grep -E ':(3000|19530|6006|9000|9001|8000)'

# åº”è¯¥çœ‹åˆ°ï¼š
# 3000  - Dify Webç•Œé¢
# 19530 - Milvuså‘é‡åº“
# 6006  - EmbeddingæœåŠ¡
# 9000  - è§†é¢‘ç†è§£API
# 9001  - å›¾åƒç†è§£API
# 8000  - LoRAæ¨ç†æœåŠ¡
```

### 3. æµ‹è¯•æœåŠ¡è¿é€šæ€§
```bash
# æµ‹è¯• Milvus
curl http://localhost:19530/health

# æµ‹è¯• Embedding æœåŠ¡
curl http://localhost:6006/health

# æµ‹è¯•è§†é¢‘ç†è§£æœåŠ¡
curl http://localhost:9000/health

# æµ‹è¯•å›¾åƒç†è§£æœåŠ¡
curl http://localhost:9001/health
```

## ğŸŒ è®¿é—®éªŒè¯

### 1. Dify ç®¡ç†ç•Œé¢
- æµè§ˆå™¨æ‰“å¼€ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:3000`
- åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
- è¿›å…¥è®¾ç½®é¡µé¢

### 2. é…ç½®æ¨¡å‹æä¾›å•†
- [ ] é…ç½® Milvus å‘é‡æ•°æ®åº“
- [ ] é…ç½® BGE Embedding æ¨¡å‹
- [ ] é…ç½®å¤šæ¨¡æ€æ¨¡å‹
- [ ] é…ç½® LoRA æ¨¡å‹

### 3. åˆ›å»ºçŸ¥è¯†åº“
- [ ] æ–°å»ºçŸ¥è¯†åº“
- [ ] ä¸Šä¼ ä¼ä¸šæ–‡æ¡£
- [ ] ç­‰å¾…å‘é‡åŒ–å®Œæˆ

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### 1. åŸºç¡€é—®ç­”æµ‹è¯•
```bash
# æµ‹è¯•ç®€ç§°æŸ¥è¯¢
"ä»€ä¹ˆæ˜¯ESSï¼Ÿ"

# æµ‹è¯•æµç¨‹æŸ¥è¯¢
"å¦‚ä½•ç”³è¯·å¹´å‡ï¼Ÿ"

# æµ‹è¯•åˆ¶åº¦æŸ¥è¯¢
"å…¬å¸åŸ¹è®­åˆ¶åº¦æ˜¯ä»€ä¹ˆï¼Ÿ"
```

### 2. å¤šæ¨¡æ€æµ‹è¯•
- [ ] ä¸Šä¼ åŒ…å«è¡¨æ ¼çš„æ–‡æ¡£
- [ ] ä¸Šä¼ åŒ…å«å›¾ç‰‡çš„æ–‡æ¡£
- [ ] ä¸Šä¼ è§†é¢‘æ–‡ä»¶
- [ ] æµ‹è¯•å„ç§æ ¼å¼çš„è§£æ

### 3. LoRA å¾®è°ƒæµ‹è¯•
```bash
# æ£€æŸ¥è®­ç»ƒç¯å¢ƒ
cd ~/LLaMA-Factory
source venv/bin/activate
python -c "import torch; print(f'CUDA available: {torch.cuda.is_available()}')"

# å¼€å§‹å¾®è°ƒ
python src/train_bash.py --stage sft --model_name_or_path deepseek-ai/DeepSeek-R1-Distill-Qwen-7B --dataset enterprise_kb --template qwen --finetuning_type lora --output_dir ./lora_ckpt --per_device_train_batch_size 4 --gradient_accumulation_steps 4 --num_train_epochs 3 --quantization_bit 4 --learning_rate 3e-4 --fp16
```

## ğŸ”§ å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### é—®é¢˜1ï¼šDocker æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# é‡å¯ Docker æœåŠ¡
sudo systemctl restart docker

# æ£€æŸ¥ Docker çŠ¶æ€
sudo systemctl status docker
```

### é—®é¢˜2ï¼šç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo lsof -i :3000

# æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 <PID>
```

### é—®é¢˜3ï¼šGPU å†…å­˜ä¸è¶³
```bash
# æ£€æŸ¥ GPU çŠ¶æ€
nvidia-smi

# æ¸…ç† GPU ç¼“å­˜
sudo fuser -v /dev/nvidia*
```

### é—®é¢˜4ï¼šæ¨¡å‹ä¸‹è½½å¤±è´¥
```bash
# ä½¿ç”¨å›½å†…é•œåƒ
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# æˆ–è€…ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ
pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### 1. ç³»ç»Ÿèµ„æºç›‘æ§
```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ GPU ä½¿ç”¨æƒ…å†µ
watch -n 1 nvidia-smi

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h
```

### 2. æœåŠ¡æ€§èƒ½ç›‘æ§
```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker logs -f dify-web
docker logs -f milvus
```

## ğŸ¯ æˆåŠŸæ ‡å¿—

å½“çœ‹åˆ°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œè¯´æ˜ç³»ç»Ÿéƒ¨ç½²æˆåŠŸï¼š

âœ… **æœåŠ¡çŠ¶æ€**ï¼šæ‰€æœ‰ Docker å®¹å™¨éƒ½æ˜¾ç¤º "Up" çŠ¶æ€
âœ… **ç«¯å£å¼€æ”¾**ï¼šæ‰€æœ‰å…³é”®ç«¯å£éƒ½èƒ½æ­£å¸¸è®¿é—®
âœ… **Webç•Œé¢**ï¼šDify ç®¡ç†ç•Œé¢èƒ½æ­£å¸¸æ‰“å¼€å’Œç™»å½•
âœ… **æ¨¡å‹é…ç½®**ï¼šæ‰€æœ‰æ¨¡å‹æä¾›å•†é…ç½®æˆåŠŸ
âœ… **çŸ¥è¯†åº“**ï¼šèƒ½æ­£å¸¸ä¸Šä¼ æ–‡æ¡£å¹¶å®Œæˆå‘é‡åŒ–
âœ… **é—®ç­”åŠŸèƒ½**ï¼šèƒ½æ­£å¸¸å›ç­”ä¼ä¸šç›¸å…³é—®é¢˜
âœ… **å¤šæ¨¡æ€**ï¼šèƒ½å¤„ç†æ–‡æ¡£ã€å›¾ç‰‡ã€è§†é¢‘ç­‰ä¸åŒæ ¼å¼

## ğŸš¨ ç´§æ€¥è”ç³»

å¦‚æœé‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼š

1. **æ£€æŸ¥æ—¥å¿—**ï¼š`docker logs <å®¹å™¨å>`
2. **é‡å¯æœåŠ¡**ï¼š`docker restart <å®¹å™¨å>`
3. **æŸ¥çœ‹çŠ¶æ€**ï¼š`docker ps` å’Œ `docker stats`
4. **ç³»ç»Ÿé‡å¯**ï¼š`sudo reboot`ï¼ˆæœ€åæ‰‹æ®µï¼‰

## ğŸ‰ æ­å–œï¼

å¦‚æœæ‰€æœ‰æ£€æŸ¥é¡¹éƒ½é€šè¿‡ï¼Œæ­å–œä½ æˆåŠŸéƒ¨ç½²äº†ä¼ä¸šçŸ¥è¯†åº“ç³»ç»Ÿï¼

ç°åœ¨å¯ä»¥ï¼š
- ä¸Šä¼ ä½ çš„ä¼ä¸šæ–‡æ¡£å’Œè§†é¢‘
- é…ç½® LoRA å¾®è°ƒ
- æµ‹è¯•å„ç§åŠŸèƒ½
- å¼€å§‹å®é™…ä½¿ç”¨

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸš€

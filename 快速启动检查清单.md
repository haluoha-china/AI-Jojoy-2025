# 🚀 企业知识库快速启动检查清单

## 📋 部署前检查

### 系统环境检查
- [ ] 确认服务器有 RTX 4090 24GB GPU
- [ ] 确认 Ubuntu 22.04 系统
- [ ] 确认网络连接正常
- [ ] 确认有足够的磁盘空间（建议 100GB+）
- [ ] 确认Python 3.8+已安装
- [ ] 确认系统盘30GB + 数据盘50GB存储配置

### 依赖服务检查
- [ ] 确认Milvus向量数据库已安装并启动
- [ ] 确认Docker服务运行正常（如果使用Docker）
- [ ] 确认端口8000未被占用

## 🚀 一键部署

### 执行部署脚本
```bash
# 1. 给脚本执行权限
chmod +x enterprise_kb_agent_setup.sh

# 2. 运行部署脚本
./enterprise_kb_agent_setup.sh
```

### 部署后验证
- [ ] Python虚拟环境创建成功
- [ ] 所有依赖包安装完成
- [ ] 项目目录结构创建完成
- [ ] 环境配置文件生成完成

## 🤖 LLaMA-Factory微调框架检查

### 基础环境检查
- [ ] LLaMA-Factory仓库克隆成功
- [ ] 核心依赖包安装完成（accelerate、peft、trl、bitsandbytes）
- [ ] 训练数据准备完成（enterprise_kb.jsonl）
- [ ] 训练配置文件生成完成（enterprise_kb_lora.yaml）

### 环境验证检查
```bash
# 检查LLaMA-Factory安装
cd /root/autodl-tmp/enterprise_kb/LLaMA-Factory
python -c "import src; print('✅ LLaMA-Factory基础功能正常')"

# 检查核心包版本
pip list | grep -E "(accelerate|peft|trl|bitsandbytes)"
```

### 存储位置检查
- [ ] LLaMA-Factory安装在数据盘（/root/autodl-tmp/enterprise_kb/）
- [ ] 避免系统盘空间占用
- [ ] 训练数据和配置存储在正确位置

## 🔧 千问Agent配置检查

### Function Call配置
- [ ] 在千问Agent中添加`search_knowledge_base`函数
- [ ] 在千问Agent中添加`parse_document`函数
- [ ] 在千问Agent中添加`process_multimodal`函数
- [ ] 配置系统提示词
- [ ] 验证Function Call配置保存成功

### API密钥配置
- [ ] 配置千问API密钥
- [ ] 验证API密钥有效性
- [ ] 测试API连接

## 🌐 服务启动检查

### 启动知识库服务
```bash
# 进入服务目录
cd ~/enterprise_kb_service

# 启动服务
./start_service.sh
```

### 服务状态检查
- [ ] FastAPI服务在8000端口正常运行
- [ ] 健康检查接口返回正常状态
- [ ] 日志文件正常生成
- [ ] 无错误信息输出

## 🧪 功能测试检查

### API接口测试
```bash
# 健康检查
curl http://localhost:8000/api/health

# 测试搜索功能
curl -X POST "http://localhost:8000/api/search" \
  -H "Content-Type: application/json" \
  -d '{"query": "ESS培训", "top_k": 3}'

# 测试文档解析
curl -X POST "http://localhost:8000/api/parse_document" \
  -F "file=@test_document.pdf"

# 测试多模态处理
curl -X POST "http://localhost:8000/api/process_multimodal" \
  -H "Content-Type: application/json" \
  -d '{"content": "分析这个培训视频", "file_type": "video"}'
```

### 千问Agent集成测试
- [ ] 测试简称查询："什么是ESS？"
- [ ] 测试流程查询："如何申请年假？"
- [ ] 测试制度查询："公司培训制度是什么？"
- [ ] 验证Function调用成功
- [ ] 验证返回结果正确

## 📊 性能监控检查

### 系统资源监控
- [ ] GPU使用率正常（nvidia-smi）
- [ ] 内存使用率正常（htop）
- [ ] 磁盘空间充足（df -h）
- [ ] 网络连接稳定

### 服务性能监控
- [ ] API响应时间 < 2秒
- [ ] Function调用成功率 > 95%
- [ ] 无内存泄漏
- [ ] 日志输出正常

## 🔍 问题排查检查

### 常见问题检查
- [ ] Python包安装是否成功
- [ ] 端口是否被占用
- [ ] GPU内存是否充足
- [ ] 千问Agent连接是否正常
- [ ] 网络连接是否稳定

### 日志检查
```bash
# 查看服务日志
tail -f ~/enterprise_kb_service/logs/enterprise_kb.log

# 查看系统日志
journalctl -u enterprise_kb -f

# 查看Python进程
ps aux | grep python
```

## 📚 知识库数据检查

### 文档上传测试
- [ ] 上传PDF文档测试
- [ ] 上传TXT文档测试
- [ ] 上传图片文档测试
- [ ] 验证文档解析成功
- [ ] 验证向量化完成

### 搜索功能测试
- [ ] 测试关键词搜索
- [ ] 测试语义搜索
- [ ] 测试多模态搜索
- [ ] 验证搜索结果相关性
- [ ] 验证搜索响应速度

## 🎯 成功标志检查

### 系统功能
- [ ] ✅ Python环境：虚拟环境激活，所有依赖包安装完成
- [ ] ✅ 服务启动：FastAPI服务在8000端口正常运行
- [ ] ✅ API接口：健康检查接口返回正常状态
- [ ] ✅ 千问Agent：Function Call配置成功，可以调用知识库函数
- [ ] ✅ 知识库：能正常上传文档并完成向量化
- [ ] ✅ 问答功能：能正常回答企业相关问题
- [ ] ✅ 多模态：能处理文档、图片、视频等不同格式
- [ ] ✅ LLaMA-Factory：微调框架安装成功，基础功能正常
- [ ] ✅ LoRA训练：7B基础模型下载完成，训练环境就绪

### 用户体验
- [ ] 千问Agent能准确理解用户问题
- [ ] Function Call调用成功率高
- [ ] 返回结果准确且有用
- [ ] 响应速度快（<2秒）
- [ ] 支持多种查询类型
- [ ] 支持LoRA微调训练
- [ ] 支持7B模型推理

## 🚨 紧急联系

如果遇到无法解决的问题：

1. **检查日志**：`tail -f ~/enterprise_kb_service/logs/enterprise_kb.log`
2. **重启服务**：`cd ~/enterprise_kb_service && ./start_service.sh`
3. **查看状态**：`ps aux | grep python` 和 `netstat -tlnp | grep :8000`
4. **系统重启**：`sudo reboot`（最后手段）

## 📋 维护检查清单

### 日常维护
- [ ] 检查服务运行状态
- [ ] 查看日志文件大小
- [ ] 监控系统资源使用
- [ ] 备份重要配置文件

### 定期维护
- [ ] 更新依赖包版本
- [ ] 清理日志文件
- [ ] 优化系统性能
- [ ] 更新知识库内容

## 🎉 完成！

当所有检查项都完成时，说明你的企业知识库系统已经成功部署并正常运行！

现在可以开始使用千问Agent来查询企业知识库了！🚀

## 📚 相关文档

- [千问Agent配置指南](千问Agent配置指南.md)
- [千问Agent代码实现总结](千问Agent代码实现总结.md)
- [基于千问Agent的企业知识库搭建方案](基于千问Agent的企业知识库搭建方案.md)
- [环境配置信息](环境配置信息.txt)

# 🚀 重新部署检查清单（基于经验教训）

## ⚠️ 重要提醒

基于2025年8月16-17日的部署经验，**强烈建议**：

1. **系统盘至少100GB**（避免30GB空间不足问题）
2. **使用稳定的版本组合**（避免CUDA 12.4兼容性问题）
3. **统一环境管理**（避免conda+pip混用问题）

## 🔍 部署前检查清单

### **硬件环境检查**
- [ ] **系统盘**：至少100GB（推荐150GB）
- [ ] **数据盘**：至少400GB（推荐500GB）
- [ ] **内存**：至少32GB（推荐64GB）
- [ ] **GPU**：RTX 4090或同等性能
- [ ] **CPU**：8核以上

### **软件环境检查**
- [ ] **操作系统**：Ubuntu 22.04 LTS（最稳定）
- [ ] **CUDA版本**：11.8或12.1（避免12.4+）
- [ ] **Python版本**：3.10或3.11（避免3.12）
- [ ] **网络连接**：稳定的网络环境

## 🎯 推荐版本组合

### **稳定版本组合（推荐）**
```
操作系统：Ubuntu 22.04 LTS
Python：3.10.12
CUDA：11.8.0
PyTorch：2.0.1
FAISS：1.7.4 (CPU) 或 1.9.0 (GPU)
Transformers：4.35.0
```

### **避免的版本组合**
```
❌ 操作系统：Ubuntu 24.04（太新）
❌ Python：3.12+（包支持不完整）
❌ CUDA：12.4+（预编译包少）
❌ PyTorch：2.8+（依赖复杂）
❌ FAISS：CUDA 12.6+（兼容性差）
```

## 🚀 部署步骤检查清单

### **第一步：环境准备**
- [ ] 检查系统资源：`df -h`、`free -h`、`nvidia-smi`
- [ ] 创建数据盘目录结构
- [ ] 设置环境变量
- [ ] 安装基础工具：git、curl、wget

### **第二步：Python环境**
- [ ] 安装Miniconda或Anaconda
- [ ] 创建专用环境：`conda create -n enterprise_kb python=3.10`
- [ ] 激活环境：`conda activate enterprise_kb`
- [ ] 验证Python版本：`python --version`

### **第三步：核心AI库**
- [ ] 安装PyTorch（指定版本）：`conda install pytorch==2.0.1 pytorch-cuda=11.8`
- [ ] 安装FAISS：`pip install faiss-cpu`（先CPU版本，确保稳定）
- [ ] 安装Transformers：`pip install transformers==4.35.0`
- [ ] 安装Sentence-Transformers：`pip install sentence-transformers==2.2.2`

### **第四步：Web框架**
- [ ] 安装FastAPI：`pip install fastapi uvicorn`
- [ ] 安装其他工具：`pip install python-multipart python-dotenv`
- [ ] 验证安装：`python -c "import fastapi; print('FastAPI安装成功')"`

### **第五步：多媒体处理**
- [ ] 安装OpenCV：`pip install opencv-python`
- [ ] 安装音频处理：`pip install librosa`
- [ ] 安装视频处理：`pip install moviepy`
- [ ] 安装语音识别：`pip install SpeechRecognition`

### **第六步：文档处理**
- [ ] 安装PDF处理：`pip install PyMuPDF`
- [ ] 安装OCR：`pip install paddlepaddle paddleocr`
- [ ] 验证安装：测试PDF解析功能

## ✅ 验证检查清单

### **核心功能验证**
- [ ] **Python环境**：`python --version` 显示3.10.x
- [ ] **PyTorch**：`python -c "import torch; print(torch.__version__)"`
- [ ] **CUDA支持**：`python -c "import torch; print(torch.cuda.is_available())"`
- [ ] **FAISS**：`python -c "import faiss; print(faiss.__version__)"`
- [ ] **FastAPI**：`python -c "import fastapi; print('FastAPI正常')"`

### **服务启动验证**
- [ ] **API服务**：`python api/main.py` 启动成功
- [ ] **端口监听**：`netstat -tlnp | grep :8000`
- [ ] **健康检查**：`curl http://localhost:8000/api/health`
- [ ] **搜索接口**：测试搜索功能正常

### **GPU功能验证**
- [ ] **GPU检测**：`nvidia-smi` 显示RTX 4090
- [ ] **CUDA版本**：`nvcc --version` 显示11
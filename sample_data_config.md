# 📋 针对你的样本数据的专门配置

## 🎯 你的样本数据特点

根据你的描述，你的样本包含：
1. **Q&A 文档**：包含问题和答案的文档
2. **内部简称文档**：定义公司内部简称的基础概念文档
3. **视频文件**：需要多模态处理的视频内容

## 📚 第一步：准备训练数据

### 1.1 基于你的 Q&A 文档创建 LoRA 训练数据

```bash
cd ~/LLaMA-Factory
nano data/enterprise_qa.jsonl
```

**数据格式示例**（请根据你的实际文档调整）：
```json
{"instruction":"ESS培训每月几次？","input":"","output":"根据《ESS培训管理制度》规定，ESS培训每月进行3次，分别在每月第一周、第三周和第五周进行。具体时间安排请查看公司内网培训日历。"}
{"instruction":"打印机出现数据库连接失败怎么办？","input":"","output":"当打印机出现数据库连接失败时，请按以下步骤处理：1. 检查MSSQLSERVER服务是否启动；2. 确认1433端口是否放行；3. 检查网络连接；4. 重启打印服务。详细操作步骤请参考《IT故障处理手册》第12页。"}
{"instruction":"什么是ESS系统？","input":"","output":"ESS（Employee Self Service）是员工自助服务系统，员工可以通过该系统进行请假申请、加班申请、考勤查询、薪资查询等操作。系统访问地址：http://ess.company.com"}
{"instruction":"如何申请年假？","input":"","output":"年假申请流程：1. 登录ESS系统；2. 选择'请假申请'；3. 填写请假类型为'年假'；4. 选择开始和结束时间；5. 填写请假事由；6. 提交申请等待审批。详细操作步骤请参考《ESS系统使用手册》。"}
{"instruction":"公司内部简称解释","input":"","output":"公司内部常用简称包括：ESS（员工自助服务）、OA（办公自动化）、ERP（企业资源规划）、CRM（客户关系管理）、HR（人力资源）、IT（信息技术）、QA（质量保证）、QC（质量控制）等。"}
```

### 1.2 基于你的内部简称文档创建概念库

```bash
nano data/company_abbreviations.jsonl
```

**简称文档格式示例**：
```json
{"instruction":"什么是ESS？","input":"","output":"ESS是Employee Self Service的缩写，中文名称：员工自助服务系统。功能包括：请假申请、加班申请、考勤查询、薪资查询、个人信息维护等。"}
{"instruction":"什么是OA？","input":"","output":"OA是Office Automation的缩写，中文名称：办公自动化系统。主要功能：文档管理、流程审批、会议安排、公告发布等。"}
{"instruction":"什么是ERP？","input":"","output":"ERP是Enterprise Resource Planning的缩写，中文名称：企业资源规划系统。涵盖：财务、采购、销售、库存、生产等业务流程管理。"}
{"instruction":"什么是CRM？","input":"","output":"CRM是Customer Relationship Management的缩写，中文名称：客户关系管理系统。功能包括：客户信息管理、销售机会跟踪、合同管理等。"}
{"instruction":"什么是HR？","input":"","output":"HR是Human Resources的缩写，中文名称：人力资源。负责：招聘、培训、绩效考核、薪酬福利、员工关系等。"}
{"instruction":"什么是IT？","input":"","output":"IT是Information Technology的缩写，中文名称：信息技术。负责：系统维护、网络管理、技术支持、数据安全等。"}
{"instruction":"什么是QA？","input":"","output":"QA是Quality Assurance的缩写，中文名称：质量保证。负责：质量标准制定、质量检查、质量改进等。"}
{"instruction":"什么是QC？","input":"","output":"QC是Quality Control的缩写，中文名称：质量控制。负责：产品质量检查、不合格品处理、质量数据统计等。"}
```

## 🎥 第二步：视频文件处理配置

### 2.1 视频理解模型配置

你的视频文件将通过 MiniCPM-V 模型进行处理：

```bash
# 检查视频理解服务状态
curl http://localhost:9000/health

# 测试视频理解功能
curl -X POST "http://localhost:9000/v1/chat/completions" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "minicpm-video",
    "messages": [
      {
        "role": "user",
        "content": [
          {
            "type": "text",
            "text": "请分析这个视频的主要内容"
          },
          {
            "type": "video_url",
            "video_url": {
              "url": "data:video/mp4;base64,你的视频base64编码"
            }
          }
        ]
      }
    ]
  }'
```

### 2.2 在 Dify 中配置视频处理

1. **创建视频知识库**：
   - 知识库类型：选择支持多模态
   - 处理模型：选择 MiniCPM-V
   - 视频分割：启用时间轴分割

2. **视频处理规则**：
   ```
   # 视频内容提取规则
   - 自动提取关键帧
   - 识别视频中的文字和图表
   - 生成视频摘要
   - 提取时间戳标记的重要信息
   ```

## 🧠 第三步：知识图谱规则配置

### 3.1 针对你的数据的智能问答规则

在 Dify 的 **提示词编排** 中设置：

```
# 企业知识库智能问答规则

你是一个专业的企业知识库助手，专门回答关于公司制度、流程、简称等问题。

## 回答规则：

### 1. 简称查询
如果用户询问公司内部简称（如ESS、OA、ERP等）：
- 提供完整的中文名称
- 解释主要功能
- 说明使用场景
- 引用相关文档

### 2. 流程查询
如果用户询问具体操作流程：
- 按步骤详细说明
- 提供注意事项
- 注明参考文档和页码
- 如有相关表格，结构化展示

### 3. 制度查询
如果用户询问公司制度：
- 提供制度要点
- 说明适用范围
- 注明生效时间
- 提供相关联系人

### 4. 多模态内容处理
如果涉及：
- 表格数据：结构化展示，保持格式
- 图片内容：描述图片要点
- 视频内容：提供视频摘要和关键时间点

## 回答格式：
1. 直接回答问题
2. 提供详细说明
3. 注明信息来源
4. 如有相关文档，提供链接或引用

## 示例回答：
用户：什么是ESS？
回答：ESS是Employee Self Service的缩写，中文名称：员工自助服务系统。

主要功能包括：
- 请假申请和审批
- 加班申请和确认
- 考勤查询和统计
- 薪资查询和明细
- 个人信息维护

系统访问地址：http://ess.company.com

参考文档：《ESS系统使用手册》第1-5页
```

### 3.2 知识图谱查询优化

```
# 知识图谱查询策略

## 查询优先级：
1. 精确匹配：直接查找简称或关键词
2. 语义匹配：基于问题意图查找相关内容
3. 关联匹配：查找相关的制度、流程、文档

## 多模态内容关联：
- 文字内容 ↔ 表格数据
- 制度文档 ↔ 操作流程
- 培训材料 ↔ 签到记录
- 视频内容 ↔ 文字说明

## 智能推荐：
基于用户查询历史，推荐相关的问题和答案
```

## 📊 第四步：测试你的样本数据

### 4.1 基础功能测试

测试以下典型问题：

```bash
# 简称查询测试
"什么是ESS？"
"OA系统有哪些功能？"
"ERP和CRM的区别是什么？"

# 流程查询测试
"如何申请年假？"
"ESS培训的流程是什么？"
"打印机故障怎么处理？"

# 制度查询测试
"公司年假制度是什么？"
"培训管理制度有哪些要求？"
"IT支持流程是什么？"
```

### 4.2 多模态内容测试

1. **表格文档测试**：
   - 上传包含表格的文档
   - 测试表格数据提取
   - 验证结构化展示

2. **图片文档测试**：
   - 上传包含图片的文档
   - 测试图片内容识别
   - 验证图文关联

3. **视频文件测试**：
   - 上传视频文件
   - 测试视频内容提取
   - 验证视频摘要生成

## 🔧 第五步：针对你的数据的优化建议

### 5.1 数据质量优化

1. **Q&A 文档优化**：
   - 确保问题和答案的对应关系清晰
   - 添加更多实际工作场景的问题
   - 包含常见错误和解决方案

2. **简称文档优化**：
   - 按部门分类整理
   - 添加使用频率标记
   - 包含相关制度和流程链接

3. **视频内容优化**：
   - 添加视频标签和分类
   - 生成关键帧截图
   - 创建视频内容索引

### 5.2 模型性能优化

1. **LoRA 微调优化**：
   - 增加训练轮数（建议3-5轮）
   - 调整学习率（建议2e-4到5e-4）
   - 添加更多样本数据

2. **向量检索优化**：
   - 调整相似度阈值（建议0.7-0.8）
   - 优化检索数量（建议top-5到top-10）
   - 启用重排序功能

## 🎯 预期效果

配置完成后，你的企业知识库将能够：

✅ **智能问答**：准确回答关于公司制度、流程、简称等问题
✅ **多模态理解**：处理文档、表格、图片、视频等多种格式
✅ **知识关联**：自动关联相关的制度、流程、文档
✅ **个性化回答**：基于LoRA微调，提供符合公司文化的回答
✅ **持续学习**：根据用户反馈不断优化回答质量

现在可以开始上传你的样本数据，测试系统功能了！
